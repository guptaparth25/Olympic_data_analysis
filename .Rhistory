# this prevents package loading message from appearing in the rendered version of your problem set
knitr::opts_chunk$set(warning = FALSE, message = FALSE,
echo = TRUE)
library(tidyverse)
library(patchwork)
library(reshape2)
# Add NAs to mtcars dataset
set.seed(5702)
mycars <- mtcars
mycars[1:25, "gear"] <- NA
mycars[10:20, 3:5] <- NA
for (i in 1:10) mycars[sample(32,1), sample(11,1)] <- NA
missing_patterns <- data.frame(is.na(mycars)) %>%
group_by_all() %>%
count(name = "count", sort = TRUE) %>%
ungroup()
sort_text <- names(sort(colSums(is.na(mycars)), decreasing = TRUE))
mod_data <- missing_patterns %>% subset(select=-count)
id <- which(rowSums(mod_data)==0)
row <- nrow(mod_data)
col <- ncol(mod_data)
mod_data <- mod_data %>%
mutate(ID = rownames(.)) %>%
melt(id.vars=c("ID")) %>%
mutate(missing = ifelse(ID == id,2,ifelse(value == "TRUE", 1, 0)))
main_ <- ggplot(mod_data, aes(x=factor(variable,levels=sort_text),
y=factor(ID,rev(unique(ID))))) +
geom_tile(aes(fill=factor(missing)),color = "white") +
scale_fill_manual(values = alpha(c("grey", "blueviolet","grey"),
c(.4,.4,0.9))) +
geom_text(aes(x=(1+col)/2,y=row-id+1), label = "complete cases") +
xlab('variable') +
ylab('missing pattern') +
guides(fill='none') +
theme_classic() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
mod_data_two <- ggplot(missing_patterns,
aes(x=factor(rownames(missing_patterns),
rev(rownames(missing_patterns))), y=count)) +
geom_bar(stat='identity',fill=ifelse(rownames(missing_patterns)==id,'cornflowerblue',alpha('cornflowerblue',0.5))) +
xlab('') +
ylab('row count') +
theme_bw() +
theme(panel.grid.major.y=element_blank()) +
coord_flip()
df_t <- data.frame(colSums(is.na(mycars)))
colnames(df_t) <- 'count'
mod_data_three <- ggplot(df_t,aes(x=factor(rownames(df_t),
levels=sort_text), y=count)) +
geom_bar(stat='identity',fill=alpha('cornflowerblue',0.5)) +
ggtitle('missing value patterns') +
theme_bw() +
theme(panel.grid.major.x=element_blank()) +
xlab('') +
ylab('num rows missing') +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
final_plot <- "
111#
2223
2223
2223
"
mod_data_three+main_+mod_data_two+plot_layout(design=final_plot)
missing_plot <- function(data, percent=FALSE)
{
missing_patterns <- data.frame(is.na(data)) %>%
group_by_all() %>%
count(name = "count", sort = TRUE) %>%
ungroup()
if(percent)
{
missing_patterns <- missing_patterns %>%
mutate(count=count/sum(count)*100)
}
sort_data <- names(sort(colSums(is.na(data)), decreasing = TRUE))
dataNew <- missing_patterns %>%
subset(select=-count)
id <- which(rowSums(dataNew)==0)
row <- nrow(dataNew)
col <- ncol(dataNew)
dataNew <- dataNew %>%
mutate(ID = rownames(.)) %>%
melt(id.vars=c("ID")) %>%
mutate(missing = ifelse(ID == id,2,ifelse(value == "TRUE", 1, 0)))
main_ <- ggplot(dataNew, aes(x=factor(variable,levels=sort_data),
y=factor(ID,rev(unique(ID))))) +
geom_tile(aes(fill=factor(missing)),color = "white") +
scale_fill_manual(values = alpha(c("grey", "blueviolet","grey"), c(.4,.4,0.9))) +
geom_text(aes(x=(1+col)/2,y=row-id+1), label = "complete cases") +
scale_x_discrete(label = function(x) abbreviate(x, minlength =5))+
xlab('variable') +
ylab('missing pattern') +
guides(fill='none') +
theme_classic() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
col_ <- ggplot(missing_patterns, aes(x=factor(rownames(missing_patterns), rev(rownames(missing_patterns))), y=count)) +
geom_bar(stat='identity', fill=ifelse(rownames(missing_patterns)==id, 'cornflowerblue', alpha('cornflowerblue',0.5))) +
xlab('') +
ylab(ifelse(percent,'%rows','row count')) +
theme_bw() +
theme(panel.grid.major.y=element_blank()) +
coord_flip()
if(percent)
{
col_<-col_+ylim(0,100)
}
DfThree <- data.frame(colSums(is.na(data)))
colnames(DfThree) <- 'count'
if(percent)
{
DfThree <- DfThree%>%mutate(count=count/nrow(data)*100)
}
row_ <- ggplot(DfThree,aes(x=factor(rownames(DfThree),
levels=sort_data), y=count)) +
geom_bar(stat='identity',fill=alpha('cornflowerblue',0.5)) +
ggtitle('missing value patterns') +
theme_bw() +
theme(panel.grid.major.x=element_blank()) +
scale_x_discrete(label = function(x) abbreviate(x, minlength =5))+
xlab('') +
ylab(ifelse(percent,'%rows missing','num rows missing')) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
if(percent)
{
row_<-row_ + ylim(0,100)
}
layout_ <- "
111#
2223
2223
2223
"
row_+main_+col_+plot_layout(design=layout_)
}
missing_plot(mycars, T)
eco <- ggplot2::economics
missing_plot(eco, TRUE)
eco <- ggplot2::economics
missing_plot(eco, FALSE)
data <- Lock5withR::HollywoodMovies2011
missing_plot(data, TRUE)
data <- Lock5withR::HollywoodMovies2011
missing_plot(data, FALSE)
data <- read.csv(file ='athlete_events.csv')
missing_plot(data, TRUE)
missing_plot(data, FALSE)
get_wd()
print(get_wd())
print(getwd())
missing_patterns <- data.frame(is.na(mycars)) %>%
group_by_all() %>%
count(name = "count", sort = TRUE) %>%
ungroup()
sort_text <- names(sort(colSums(is.na(mycars)), decreasing = TRUE))
mod_data <- missing_patterns %>% subset(select=-count)
id <- which(rowSums(mod_data)==0)
row <- nrow(mod_data)
col <- ncol(mod_data)
mod_data <- mod_data %>%
mutate(ID = rownames(.)) %>%
melt(id.vars=c("ID")) %>%
mutate(missing = ifelse(ID == id,2,ifelse(value == "TRUE", 1, 0)))
main_ <- ggplot(mod_data, aes(x=factor(variable,levels=sort_text),
y=factor(ID,rev(unique(ID))))) +
geom_tile(aes(fill=factor(missing)),color = "white") +
scale_fill_manual(values = alpha(c("grey", "blueviolet","grey"),
c(.4,.4,0.9))) +
geom_text(aes(x=(1+col)/2,y=row-id+1), label = "complete cases") +
xlab('variable') +
ylab('missing pattern') +
guides(fill='none') +
theme_classic() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
mod_data_two <- ggplot(missing_patterns,
aes(x=factor(rownames(missing_patterns),
rev(rownames(missing_patterns))), y=count)) +
geom_bar(stat='identity',fill=ifelse(rownames(missing_patterns)==id,'cornflowerblue',alpha('cornflowerblue',0.5))) +
xlab('') +
ylab('row count') +
theme_bw() +
theme(panel.grid.major.y=element_blank()) +
coord_flip()
df_t <- data.frame(colSums(is.na(mycars)))
colnames(df_t) <- 'count'
mod_data_three <- ggplot(df_t,aes(x=factor(rownames(df_t),
levels=sort_text), y=count)) +
geom_bar(stat='identity',fill=alpha('cornflowerblue',0.5)) +
ggtitle('missing value patterns') +
theme_bw() +
theme(panel.grid.major.x=element_blank()) +
xlab('') +
ylab('num rows missing') +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
final_plot <- "
111#
2223
2223
2223
"
mod_data_three+main_+mod_data_two+plot_layout(design=final_plot)
data <- read.csv(file ='./athlete_events.csv')
missing_plot(data, TRUE)
install.packages('bookdown')
library(tidyverse)
library(patchwork)
install.packages('patchwork')
install.packages('reshape2')
library(reshape2)
missing_plot <- function(data, percent=FALSE)
{
missing_patterns <- data.frame(is.na(data)) %>%
group_by_all() %>%
count(name = "count", sort = TRUE) %>%
ungroup()
if(percent)
{
missing_patterns <- missing_patterns %>%
mutate(count=count/sum(count)*100)
}
sort_data <- names(sort(colSums(is.na(data)), decreasing = TRUE))
dataNew <- missing_patterns %>%
subset(select=-count)
id <- which(rowSums(dataNew)==0)
row <- nrow(dataNew)
col <- ncol(dataNew)
dataNew <- dataNew %>%
mutate(ID = rownames(.)) %>%
melt(id.vars=c("ID")) %>%
mutate(missing = ifelse(ID == id,2,ifelse(value == "TRUE", 1, 0)))
main_ <- ggplot(dataNew, aes(x=factor(variable,levels=sort_data),
y=factor(ID,rev(unique(ID))))) +
geom_tile(aes(fill=factor(missing)),color = "white") +
scale_fill_manual(values = alpha(c("grey", "blueviolet","grey"), c(.4,.4,0.9))) +
geom_text(aes(x=(1+col)/2,y=row-id+1), label = "complete cases") +
scale_x_discrete(label = function(x) abbreviate(x, minlength =5))+
xlab('variable') +
ylab('missing pattern') +
guides(fill='none') +
theme_classic() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
col_ <- ggplot(missing_patterns, aes(x=factor(rownames(missing_patterns), rev(rownames(missing_patterns))), y=count)) +
geom_bar(stat='identity', fill=ifelse(rownames(missing_patterns)==id, 'cornflowerblue', alpha('cornflowerblue',0.5))) +
xlab('') +
ylab(ifelse(percent,'%rows','row count')) +
theme_bw() +
theme(panel.grid.major.y=element_blank()) +
coord_flip()
if(percent)
{
col_<-col_+ylim(0,100)
}
DfThree <- data.frame(colSums(is.na(data)))
colnames(DfThree) <- 'count'
if(percent)
{
DfThree <- DfThree%>%mutate(count=count/nrow(data)*100)
}
row_ <- ggplot(DfThree,aes(x=factor(rownames(DfThree),
levels=sort_data), y=count)) +
geom_bar(stat='identity',fill=alpha('cornflowerblue',0.5)) +
ggtitle('missing value patterns') +
theme_bw() +
theme(panel.grid.major.x=element_blank()) +
scale_x_discrete(label = function(x) abbreviate(x, minlength =5))+
xlab('') +
ylab(ifelse(percent,'%rows missing','num rows missing')) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
if(percent)
{
row_<-row_ + ylim(0,100)
}
layout_ <- "
111#
2223
2223
2223
"
row_+main_+col_+plot_layout(design=layout_)
}
data <- read.csv(file ='./athlete_events.csv')
missing_plot(data, TRUE)
install.packages("patchwork")
missing_plot(data, FALSE)
data <- read.csv(file ='./athlete_events.csv')
missing_plot(data, TRUE)
