---
title: "Project"
author: "Parth Gupta"
date: "12/4/2021"
output: html_document
---

```{r}
library("plotly")
library("tidyverse")
library("data.table")
library("knitr")
library("grid")
library("gridExtra")
library("dplyr")
library('ggrepel')
library(ggplot2)
library(reshape2)

df <- read_csv("athlete_events.csv",
                 col_types = cols(
                   identity = col_character(),
                   Name = col_character(),
                   Sex = col_factor(levels = c("M","F")),
                   Age =  col_integer(),
                   Height = col_double(),
                   Weight = col_double(),
                   Team = col_character(),
                   NOC = col_character(),
                   Games = col_character(),
                   Year = col_integer(),
                   Season = col_factor(levels = c("Summer","Winter")),
                   City = col_character(),
                   Sport = col_character(),
                   Event = col_character(),
                   Medal = col_factor(levels = c("Gold","Silver","Bronze"))
                 )
)

df2 = read.csv('./athlete_events.csv')

opts_chunk$set(warning=FALSE, message=FALSE)
```
```{r}

counts <- df %>% group_by(Year, Season) %>% summarize(Athletes = length(unique(identity)),)

p1 <- ggplot(counts, aes(x=Year, y=Athletes, group=Season, color=Season)) +
  geom_point(size=1.5) +
  geom_line() +
  scale_color_manual(values=c("red","blue")) +
  xlab("Years") +
  ylab("Number of Olympians")+
  ggtitle("Number of Olympians in Summer and Winter Olympics from 1896 to 2016")+
  annotate("text", x=c(1900, 1932,1956,1976,1980, 1992, 2016), y=c(-100, 1400,2750,7400,4700,800, 10000),
           label=c("Athens 1896", "L.A. 1932","Melbourne 1956","Montreal 1976","Moscow 1980","Change in Winter Olympics in 1992", "Rio 2016"), size=3) +
  annotate("text",x=c(1916,1942),y=c(6500,6500), label=c("World War I","World War II"), size=4) +
  geom_segment(mapping=aes(x=1914,y=6000,xend=1918,yend=6000),color="darkred", size=2) +
  geom_segment(mapping=aes(x=1939,y=6000,xend=1945,yend=6000),color="darkred", size=2)

ggplotly(p1, tooltip = c("Year", "Athletes"))
```

```{r}
# changing the year to match the summer games after 1992
old_year <- c(1994,1998,2002,2006,2010,2014)
new_year <- c(1996,2000,2004,2008,2012,2016)
for (i in 1:length(old_year)){
  df2$Year <- gsub(old_year[i], new_year[i], df$Year)
}
df2$Year = as.integer(df2$Year)

df_gender = df2 %>% group_by(Year, Sex) %>% 
  summarise(Athletes = length(unique(identity)))
df_gender$Year = as.integer(df_gender$Year)

ggplot(data=df_gender, aes(x=Year, y=Athletes, group=Sex)) +
  geom_line(aes(color=Sex)) +
  geom_point(aes(color=Sex))
```


```{r, fig.width=11, fig.height=4}

men_age <- filter(df, Sex == "M")
women_age <- filter(df, Sex == "F")

ggplot(men_age, aes(y = Age, x = as.factor(Year))) +
  geom_boxplot() + 
  labs(title = "Distribution of Male participants from 1896 to 2016",
       x = "Year",
       y = "Age")

ggplot(women_age, aes(y = Age, x = as.factor(Year))) +
  geom_boxplot() + 
  labs(title = "Distribution of Female participants from 1896 to 2016",
       x = "Year",
       y = "Age")

```

```{r}
age_m <- df%>%filter(!is.na(Age), Season=='Summer')
age_m$Medal <- ifelse(is.na(age_m$Medal),"No medal",ifelse(age_m$Medal=="Gold","Gold",ifelse(age_m$Medal=="Silver","Silver","Bronze")))

order <- c('Gold', 'Silver', 'Bronze', 'No medal')

age_m$Medal <- fct_relevel(age_m$Medal, order)

bp <-ggplot(age_m, aes(y = Age, x = Medal, fill= Medal)) +
  geom_boxplot()+ 
  labs(title = "Distribution of Age of olympians",
       x = "Medal type",
       y = "Age") + facet_grid(cols = vars(Sex))
bp + scale_fill_manual(breaks = c("Gold", "Silver", "Bronze", 'No medal'), 
                       values=c("#C9B037", "#D7D7D7", "#6A3805", 'black'))
```
```{r}
age_m <- df%>%filter(!is.na(Age), Season=='Winter')
age_m$Medal <- ifelse(is.na(age_m$Medal),"No medal",ifelse(age_m$Medal=="Gold","Gold",ifelse(age_m$Medal=="Silver","Silver","Bronze")))

order <- c('Gold', 'Silver', 'Bronze', 'No medal')

age_m$Medal <- fct_relevel(age_m$Medal, order)

bp <-ggplot(age_m, aes(y = Age, x = Medal, fill= Medal)) +
  geom_boxplot()+ 
  labs(title = "Distribution of Age of olympians",
       x = "Medal type",
       y = "Age") + facet_grid(cols = vars(Sex))
bp + scale_fill_manual(breaks = c("Gold", "Silver", "Bronze", 'No medal'), 
                       values=c("#C9B037", "#D7D7D7", "#6A3805", 'black'))
```
```{r}
features <- df[,c(3:6,10,13)]
features <- features[complete.cases(features), ] 
features %>% filter(Year >= 1924) %>% ggplot(aes(y = Height, x = Weight)) + geom_density_2d(aes(color = as.factor(Sex))) + facet_wrap(.~Year)
```
Initially we considered the plots from 1896 but since female participants were very less till 1912 and then there was first world war so we have decided to consider athletes from 1924 as were have sufficient data from that year onwards.

It is clearly evident from the above plot that Male athletes are taller and heavier than female athletes in general.
```{r}
gym<-features %>% filter(Year == 2016) %>% filter(Sport == "Gymnastics") %>% ggplot(aes(x = Height, y = Weight)) + geom_density_2d(aes(color = as.factor(Sex))) + xlim(c(120, 220)) + ylim(30, 150) + theme(legend.position = "none")
basket<-features %>% filter(Year == 2016) %>% filter(Sport == "Basketball") %>% ggplot(aes(x = Height, y = Weight)) + geom_density_2d(aes(color = as.factor(Sex))) + xlim(c(120, 220)) + ylim(30, 150)

grid.arrange(gym, basket, nrow = 1,  widths = c(1.25, 1.75))
```
In this plot we have compared the average weight and average height for athletes in 2016 Olympics in Gymnastics and Basketball.  Also, Athletes who play Basketball are taller and heavier than who do Gymnastics. 

17-year-old Brazilian gymnast Flavia Saraiva, is the lightest athletes at only 31kg (68 lbs) and she was also the shortest. Also, Basketball players are very tall and heavy. 
```{r}
options(ggrepel.max.overlaps = Inf)
features <- features %>% group_by(Sport) %>% sample_n(25, replace =  TRUE)

features <- features %>% mutate(Sex = ifelse(Sex == "M",1,0))
features
```
```{r ,fig.width= 7, fig.height= 7}
cfeat <- features[,c(1:4)]
cfeat

clust <- kmeans(scale(cfeat), 25)
labels <- clust$cluster

cfeat <- cfeat %>% mutate(labels = labels) %>% mutate(Year = features$Year) %>% mutate(Sport = features$Sport) %>% mutate(Age = features$Age)

sportMean <- cfeat %>% group_by(Sport) %>% mutate(sportAvgHeight = mean(Height)) %>% mutate(sportAvgWeight = mean(Weight))
sportMean <- distinct(sportMean,Sport, .keep_all = TRUE)
sportMean %>% ggplot() + geom_label_repel(aes(label = Sport,x = sportAvgHeight, y = sportAvgWeight), size = 4)

```
The dataset we are working on is the Olympic Games dataset that we scraped from http://www.olympedia.org/. It includes all the Games from Athens 1896 to Rio 2016. #The R code I used to scrape and wrangle the data is on GitHub.#

The file athlete_events.csv contains 271116 rows and 15 columns. Each row corresponds to an athlete competing in a particular Olympic event. The columns are:
Identity - Unique number for each athlete
Name - Athlete's name
Sex - M or F
Age - Integer
Height - In centimeters
Weight - In kilograms
Team - Team name
NOC - National Olympic Committee 3-letter code
Games - Year and season
Year - Integer between 1896 to 2016
Season - Summer or Winter
City - Host city
Sport - Sport
Event - Event
Medal - Gold, Silver, Bronze, or NA

After 1992, the Winter and Summer Games were held in different years. 
Winter Games occurred every four years starting from 1994, and Summer Games occurred every four years beginning in 1996. 

Plot-1
The above graph shows the participation of athletes from 1896 to 2016.
Key Observations:-
1) Modern Olympics were first organized in Athens with all-male participants from 12 countries. Winter Olympics were introduced in 1924.
2) After 1992, the Winter and Summer Games were held in different years. 
Winter Games occurred every four years starting from 1994, and Summer Games occurred every four years beginning in 1996.
3) We can also observe that no Olympics were organized between 1912 to 1920 and 1936 to 1948 because of World War I and World War II.
4) During the Olympics at Los Angeles in 1932, the participation dipped because the Olympics were held during the great depression.
5) During the 1976 Olympics at Montreal, there was a dip in attendance because 25 nations decided to boycott the Olympics in retaliation for apartheid policies in South Africa.
6) During Olympics at Moscow in 1980, the number of Olympics who participated decreased because 66 nations decided to boycott the Olympics.
7) Winter Olympics have much less participation than summer Olympics because ice and snow sports are not practical or popular in most nations due to climate conditions. This doesn't appear to change anytime soon.
8) 2016 Summer Olympics was held in Rio, and it had maximum participation.

Plot 2)
The above plot is a boxplot of participants' age from the Olympics in 1896 to 2016.

1) the median age of male participants from 1896 to 2016 is between 23-26. And the median age remains almost constant.
2) The Youngest Olympian of all time was Dimitrios Loundras of Greece, who at age 10 in 1896 won a bronze medal in gymnastics, which can be seen as an outlier in the year 1896.
3) The oldest Olympian medalist of all time was a Swedish shooter Oscar Swahn, who was 72 years, 280 days old when he won a silver medal in the 1920 Olympics.
4) Female Olympians were allowed after 1920, so there is no data for 1896. The median age of female Olympians first increases, then it stabilizes.
5) Also, the spread of female participants is less than that of the male participants.

Plot 3)

Initially, we considered the plots from 1896, but since female participants were very few till 1912 and then there was the first world war, so we have decided to consider athletes from 1924 as were have sufficient data from that year onwards.

It is clearly evident from the above plot that Male athletes are taller and heavier than female athletes in general for all the Olympics from 1896 to 2016.

In this plot, we have compared the average weight and average height for athletes in the 2016 Olympics in Gymnastics and Basketball.  Also, Athletes who play Basketball are taller and heavier than those who do Gymnastics. 

17-year-old Brazilian gymnast Flavia Saraiva is the lightest athlete at only 31kg (68 lbs), and she was also the shortest. In general, Basketball players are very tall and heavy.

Plot 4)
This plot is the distribution of different sports based on the average height and average weight for the athletes from 1896 to 2016. 
We can see that athletes playing sports like Tug of War, Basketball, Baseball, and Bobsleigh are some of the tallest and heaviest athletes.
On the other end, athletes who do Gymnastics, Synchronized Swimming, Diving, Rhythmic Gymnastics are very light and short.
And most of the sports lie in between the extreme ends like football, boxing, fencing.